/*!
    photobox v1.9.8
    (c) 2013 Yair Even Or <http://dropthebit.com>

    MIT-style license.
*/

// When update, don't forget to replace thumbSrc = thumbImg.getAttribute('src'); with thumbSrc = thumbImg.getAttribute('data-photobox-thumb');


(function(e,t,n){"use strict";function V(e,t){var n=false;return function(){if(!n){e.call();n=true;setTimeout(function(){n=false},t)}}}function $(){w&&X.hide();e(t).on("touchstart.testMouse",function(){e(t).off("touchstart.testMouse");E=true;X.addClass("mobile")});R.off().on("click",m.toggle);U.off().on("click","a",d.click);b&&X.addClass("msie");X.off().on("click","img",function(e){e.stopPropagation()});e(t.body).append(X);v=t.documentElement}function J(e,t,n){if(t==1){D.css({transform:"translateX(25%)",transition:".2s",opacity:0});setTimeout(function(){g(h)},200)}else if(t==-1){D.css({transform:"translateX(-25%)",transition:".2s",opacity:0});setTimeout(function(){g(p)},200)}if(n==1)j.prop("checked",true);else if(n==-1)j.prop("checked",false)}function K(e){var n,r=t.createElement("p").style,i=["ms","O","Moz","Webkit"];if(r[e]=="")return e;e=e.charAt(0).toUpperCase()+e.slice(1);for(n=i.length;n--;)if(r[i[n]+e]=="")return i[n]+e}function Q(e){var t=e.keyCode,n=s.keys,r;return n.close.indexOf(t)>=0&&ct()||n.next.indexOf(t)>=0&&!s.single&&et(p)||n.prev.indexOf(t)>=0&&!s.single&&et(h)||true}function G(e,t,n){if(n==1)et(p);else if(n==-1)et(h)}function Y(){var e=this.id=="pbPrevBtn"?h:p;et(e);return false}function Z(e){l=a;a=e;f=o[e][0];h=(a||(s.loop?o.length:0))-1;p=(a+1)%o.length||(s.loop?0:-1)}function et(e){if(!s.loop){var t=a==o.length-1&&e==p,n=a==0&&e==h;if(t||n)return}g(e)}function tt(){var t=o[a][0],n=e("<a>").prop("href",o[a][0])[0].search?"&":"?";t+=n+"vq=hd720&wmode=opaque";return e("<iframe>").prop({scrolling:"no",frameborder:0,allowTransparency:true,src:t}).attr({webkitAllowFullScreen:true,mozallowfullscreen:true,allowFullScreen:true})}function nt(){I.off(y).removeClass("change");if(s.counter){try{var e=s.counter.replace("A",a+1).replace("B",o.length)}catch(t){s.counter="(A/B)";nt()}F.find(".counter").text(e)}if(s.title)F.find(".title").html("<span>"+o[a][1]+"</span>")}function it(){X.addClass("error");D[0].src=N;A.onerror=null}function st(e){function r(){clearTimeout(n);t.off(y).css({transition:"none"});X.removeClass("video");if(c=="video"){D[0].src=N;P.addClass("prepare");X.addClass("video")}else D.prop({src:f,"class":"prepare"});setTimeout(function(){D.add(P).removeAttr("style").removeClass("prepare");X.removeClass("hide next prev");setTimeout(function(){D.add(P).on(y,ot);if(b)ot()},0)},50)}var t,n;n=setTimeout(r,2e3);q.fadeOut(300,function(){X.removeClass("pbLoading");q.removeAttr("style")});X.addClass("hide");D.add(P).removeAttr("style").removeClass("zoomable");if(!e&&u[l].rel=="video"){t=P;D.addClass("prepare")}else t=D;if(e||b)r();else t.on(y,r)}function ot(){D.add(P).off(y).addClass("zoomable");if(c=="video")P.removeClass("hide");else{R&&s.autoplay&&m.play()}if(typeof i.callback=="function")i.callback.apply(u[a])}function ut(n,r,i){if(i)return false;if(c=="video"){var s=P.data("zoom")||1;s+=r/10;if(s<.5)return false;P.data("zoom",s).css({width:624*s,height:351*s})}else{var s=D.data("zoom")||1,o=D[0].getBoundingClientRect();s+=r/10;if(s<.1)s=.1;L(function(){D.data("zoom",s).css({transform:"scale("+s+")"})});if(o.height>v.clientHeight||o.width>v.clientWidth){e(t).on("mousemove.photobox",ft)}else{e(t).off("mousemove.photobox");D[0].style[C]="50% 50%"}}return false}function at(e,t){e.preventDefault();e.stopPropagation();var n=i.thumbsList,r;n.css("height",n[0].clientHeight+t*10);r=F[0].clientHeight/2;z[0].style.cssText="margin-top: -"+r+"px; padding: "+r+"px 0;";U.hide().show(0)}function ft(e){var t=e.clientY/v.clientHeight*(v.clientHeight+200)-100,n=t/v.clientHeight*100,r=e.clientX/v.clientWidth*100,i=r.toFixed(2)+"% "+n.toFixed(2)+"%";L(function(){D[0].style[C]=i})}function lt(){clearTimeout(m.autoPlayTimer);e(t).off("mousemove.photobox");A.onload=function(){};A.src=O.src=M.src=f}function ct(){function t(){if(X[0].className=="")return;X.removeClass("show hide error pbLoading");D.removeAttr("class").removeAttr("style").off().data("zoom",1);F.find(".title").empty();if(w)setTimeout(function(){X.hide()},200);s.hideFlash&&e("iframe, object, embed").css("visibility","visible")}if(!X.hasClass("show"))return false;lt();P.find("iframe").prop("src","").empty();r.prototype.setup();rt.clear();X.removeClass("on video").addClass("hide");D.on(y,t);b&&t();setTimeout(function(){i=null},1e3);setTimeout(t,500);if(typeof s.afterClose==="function")s.afterClose(X)}var r,i,s,o=[],u,a=-1,f,l,c,h,p,d,v,m,g,y="transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",b=!("placeholder"in t.createElement("input")),w=function(){var t=e("<p>")[0];t.style.cssText="pointer-events:auto";return!t.style.pointerEvents}(),E=false,S,x,T=e(),N="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",C=K("transformOrigin"),k=K("transition"),L=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)},A={},O=new Image,M=new Image,_,D,P,H,B,j,F,I,q,R,U,z,W={single:false,beforeShow:null,afterClose:null,loop:true,thumb:null,thumbs:true,counter:"(A/B)",title:true,autoplay:false,time:3e3,history:true,hideFlash:true,zoomable:true,wheelNextPrev:true,keys:{close:"27, 88, 67",prev:"37, 80",next:"39, 78"}},X=e('<div id="pbOverlay">').append(j=e('<input type="checkbox" id="pbThumbsToggler" checked hidden>'),q=e('<div class="pbLoader"><b></b><b></b><b></b></div>'),H=e('<div id="pbPrevBtn" class="prevNext"><b></b></div>').on("click",Y),B=e('<div id="pbNextBtn" class="prevNext"><b></b></div>').on("click",Y),z=e('<div class="pbWrapper">').append(D=e("<img>"),P=e("<div>")),_=e('<div id="pbCloseBtn">').on("click",ct)[0],R=e('<div id="pbAutoplayBtn">').append(e('<div class="pbProgress">')),F=e('<div id="pbCaption">').append('<label for="pbThumbsToggler" title="thumbnails on/off"></label>',I=e('<div class="pbCaptionText">').append('<div class="title"></div><div class="counter">'),U=e("<div>").addClass("pbThumbs")));e.fn.photobox=function(t,n,s){return this.each(function(){var o,u=e(this).data("_photobox");if(u){if(t==="destroy")u.destroy();return this}if(typeof t!="string")t="a";if(t==="prepareDOM"){$();return this}o=e.extend({},W,n||{});i=new r(o,this,t);e(this).data("_photobox",i);i.callback=s})};r=function(n,r,i){this.options=e.extend({},n);this.target=i;this.selector=e(r||t);this.thumbsList=null;var s=this.imageLinksFilter(this.selector.find(i));this.imageLinks=s[0];this.images=s[1];this.init()};r.prototype={init:function(){var e=this;this.selector.one("mouseenter.photobox",this.target,function(t){e.thumbsList=d.generate.apply(e)});this.selector.on("click.photobox",this.target,function(t){t.preventDefault();e.open(this)});this.observerTimeout=null;if(this.selector[0].nodeType==1)e.observeDOM(e.selector[0],this.onDOMchanges.bind(this))},onDOMchanges:function(e){var t=e;clearTimeout(this.observerTimeout);t.observerTimeout=setTimeout(function(){var e=t.imageLinksFilter(t.selector.find(t.target)),n=0,r=false,s;if(t.imageLinks.length==e[0].length)return;t.imageLinks=e[0];t.images=e[1];if(i){if(t.selector==i.selector){o=t.images;u=t.imageLinks;for(s=o.length;s--;){if(o[s][0]==f)r=true}}}t.thumbsList=d.generate.apply(t);U.html(t.thumbsList);if(t.images.length&&f&&t.options.thumbs){n=t.thumbsList.find('a[href="'+f+'"]').eq(0).parent().index();if(n==-1)n=0;d.changeActive(n,0)}},50)},open:function(t){var n=e.inArray(t,this.imageLinks);if(n==-1)return false;s=this.options;o=this.images;u=this.imageLinks;i=this;this.setup(1);X.on(y,function(){X.off(y).addClass("on");g(n,true)}).addClass("show");if(b)X.trigger("MSTransitionEnd");return false},imageLinksFilter:function(t){var n=this,r=[],i={},s;return[t.filter(function(t){var o=e(this),u,a="";i.content=o[0].getAttribute("title")||"";if(n.options.thumb)u=o.find(n.options.thumb)[0];if(!n.options.thumb||!u)u=o.find("img")[0];if(u){s=u.getAttribute("data-pb-captionlink");a=u.getAttribute("data-photobox-thumb");i.content=u.getAttribute("alt")||u.getAttribute("title")||""}if(s){s=s.split("[");if(s.length==2){i.linkText=s[0];i.linkHref=s[1].slice(0,-1)}else{i.linkText=s;i.linkHref=s}i.content+=' <a href="'+i.linkHref+'">'+i.linkText+"</a>"}r.push([o[0].href,i.content,a]);return true}),r]},observeDOM:function(){var e=n.MutationObserver||n.WebKitMutationObserver,t=n.addEventListener;return function(n,r){if(e){var i=this;var s=new e(function(e,t){if(e[0].addedNodes.length||e[0].removedNodes.length)r(i)});s.observe(n,{childList:true,subtree:true})}else if(t){n.addEventListener("DOMNodeInserted",r,false);n.addEventListener("DOMNodeRemoved",r,false)}}}(),setup:function(r){var i=r?"on":"off";D[0].src=N;if(s.thumbs){if(!E){U[i]("mouseenter.photobox",d.calc)[i]("mousemove.photobox",d.move)}}if(r){D.css({transition:"0s"}).removeAttr("style");X.show();U.html(this.thumbsList).trigger("mouseenter.photobox");if(s.thumbs){X.addClass("thumbs")}else{j.prop("checked",false);X.removeClass("thumbs")}if(this.images.length<2||s.single)X.removeClass("thumbs hasArrows hasCounter hasAutoplay");else{X.addClass("hasArrows hasCounter");if(s.time>1e3){X.addClass("hasAutoplay");if(s.autoplay)m.progress.start();else m.pause()}else X.removeClass("hasAutoplay")}s.hideFlash&&e("iframe, object, embed").css("visibility","hidden")}else{e(n).off("resize.photobox")}e(t).off("keydown.photobox")[i]({"keydown.photobox":Q});if(E){X.removeClass("hasArrows");z[i]("swipe",J)}if(s.zoomable){X[i]({"mousewheel.photobox":ut});if(!b)U[i]({"mousewheel.photobox":at})}if(!s.single&&s.wheelNextPrev){X[i]({"mousewheel.photobox":V(G,1e3)})}},destroy:function(){s=this.options;this.selector.off("click.photobox",this.target).removeData("_photobox");ct()}};d=function(){var t=0,n=0,r=0,i=0,s=null,o,u,a,f,l,c;return{generate:function(){var t=e("<ul>"),n=[],r=this.imageLinks.size(),i,s,o,u,a;for(a=0;a<r;a++){o=this.imageLinks[a];s=this.images[a][2];if(!s)continue;i=this.images[a][1];u=o.rel?" class='"+o.rel+"'":"";n.push("<li"+u+'><a href="'+o.href+'"><img src="'+s+'" alt="" title="'+i+'" /></a></li>')}t.html(n.join(""));return t},click:function(t){t.preventDefault();T.removeClass("active");T=e(this).parent().addClass("active");var n=e(this.parentNode).index();return g(n,0,1)},changeActiveTimeout:null,changeActive:function(e,t,n){var r=T.index();T.removeClass("active");T=U.find("li").eq(e).addClass("active");if(n||!T[0])return;clearTimeout(this.changeActiveTimeout);this.changeActiveTimeout=setTimeout(function(){var e=T[0].offsetLeft+T[0].clientWidth/2-v.clientWidth/2;t?U.delay(800):U.stop();U.animate({scrollLeft:e},500,"swing")},200)},calc:function(e){u=U[0];t=u.clientWidth;n=u.scrollWidth;o=.15*t;r=U.offset().left;i=e.pageX-o-r;c=i/(t-o*2);l=(n-t)*c;U.animate({scrollLeft:l},200);clearTimeout(s);s=setTimeout(function(){s=null},200);return this},move:function(e){if(s)return;var i=n/t,a=e.pageX-o-r,f,l;if(a<0)a=0;f=a/(t-o*2);l=(n-t)*f;L(function(){u.scrollLeft=l})}}}();m={autoPlayTimer:false,play:function(){m.autoPlayTimer=setTimeout(function(){g(p)},s.time);m.progress.start();R.removeClass("play");m.setTitle("Click to stop autoplay");s.autoplay=true},pause:function(){clearTimeout(m.autoPlayTimer);m.progress.reset();R.addClass("play");m.setTitle("Click to resume autoplay");s.autoplay=false},progress:{reset:function(){R.find("div").removeAttr("style");setTimeout(function(){R.removeClass("playing")},200)},start:function(){if(!b)R.find("div").css(k,s.time+"ms");R.addClass("playing")}},setTitle:function(e){if(e)R.prop("title",e+" (every "+s.time/1e3+" seconds)")},toggle:function(e){e.stopPropagation();m[s.autoplay?"pause":"play"]()}};g=function(){var e;return function(t,n,r){if(e)return;e=setTimeout(function(){e=null},150);if(!t||t<0)t=0;if(!s.loop){B[t==o.length-1?"addClass":"removeClass"]("hide");H[t==0?"addClass":"removeClass"]("hide")}if(typeof s.beforeShow=="function")s.beforeShow(u[t]);X.removeClass("error").addClass(t>a?"next":"prev");Z(t);lt();P.empty();A.onerror=null;D.add(P).data("zoom",1);c=u[t].rel=="video"?"video":"image";if(c=="video"){P.html(tt()).addClass("hide");st(n)}else{var i=setTimeout(function(){X.addClass("pbLoading")},50);if(b)X.addClass("hide");s.autoplay&&m.progress.reset();A=new Image;A.onload=function(){A.onload=null;if(h>=0)O.src=o[h][0];if(p>=0)M.src=o[p][0];clearTimeout(i);st(n)};A.onerror=it;A.src=f}I.on(y,nt).addClass("change");if(n||b)nt();if(s.thumbs)d.changeActive(t,n,r);rt.save()}}();var rt={save:function(){if("pushState"in window.history&&decodeURIComponent(window.location.hash.slice(1))!=f&&s.history){window.history.pushState("photobox",t.title+"-"+o[a][1],window.location.pathname+window.location.search+"#"+encodeURIComponent(f))}},load:function(){if(s&&!s.history)return false;var t=decodeURIComponent(window.location.hash.slice(1)),n,r;if(!t&&X.hasClass("show"))ct();e('a[href="'+t+'"]').trigger("click.photobox")},clear:function(){if(s.history&&"pushState"in window.history)window.history.pushState("photobox",t.title,window.location.pathname+window.location.search)}};window.onpopstate=function(){var e=window.onpopstate;return function(t){e&&e.apply(this,arguments);if(t.state=="photobox")rt.load()}}();e.event.special.swipe={setup:function(){e(this).bind("touchstart",e.event.special.swipe.handler)},teardown:function(){e(this).unbind("touchstart",e.event.special.swipe.handler)},handler:function(t){function f(){a.removeEventListener("touchmove",l);i=s=null}function l(r){r.preventDefault();var l=i-r.touches[0].pageX,c=s-r.touches[0].pageY;if(Math.abs(l)>=20){f();o=l>0?-1:1}else if(Math.abs(c)>=20){f();u=c>0?1:-1}t.type="swipe";n.unshift(t,o,u);return(e.event.dispatch||e.event.handle).apply(a,n)}var n=[].slice.call(arguments,1),r=t.originalEvent.touches,i,s,o=0,u=0,a=this;t=e.event.fix(t);if(r.length==1){i=r[0].pageX;s=r[0].pageY;this.addEventListener("touchmove",l,false)}}};!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){function t(t){var o=t||window.event,u=a.call(arguments,1),f=0,c=0,h=0,p=0,d=0,v=0;if(t=e.event.fix(o),t.type="mousewheel","detail"in o&&(h=-1*o.detail),"wheelDelta"in o&&(h=o.wheelDelta),"wheelDeltaY"in o&&(h=o.wheelDeltaY),"wheelDeltaX"in o&&(c=-1*o.wheelDeltaX),"axis"in o&&o.axis===o.HORIZONTAL_AXIS&&(c=-1*h,h=0),f=0===h?c:h,"deltaY"in o&&(h=-1*o.deltaY,f=h),"deltaX"in o&&(c=o.deltaX,0===h&&(f=-1*c)),0!==h||0!==c){if(1===o.deltaMode){var m=e.data(this,"mousewheel-line-height");f*=m,h*=m,c*=m}else if(2===o.deltaMode){var g=e.data(this,"mousewheel-page-height");f*=g,h*=g,c*=g}if(p=Math.max(Math.abs(h),Math.abs(c)),(!s||s>p)&&(s=p,r(o,p)&&(s/=40)),r(o,p)&&(f/=40,c/=40,h/=40),f=Math[f>=1?"floor":"ceil"](f/s),c=Math[c>=1?"floor":"ceil"](c/s),h=Math[h>=1?"floor":"ceil"](h/s),l.settings.normalizeOffset&&this.getBoundingClientRect){var y=this.getBoundingClientRect();d=t.clientX-y.left,v=t.clientY-y.top}return t.deltaX=c,t.deltaY=h,t.deltaFactor=s,t.offsetX=d,t.offsetY=v,t.deltaMode=0,u.unshift(t,f,c,h),i&&clearTimeout(i),i=setTimeout(n,200),(e.event.dispatch||e.event.handle).apply(this,u)}}function n(){s=null}function r(e,t){return l.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120===0}var i,s,o=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],u="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],a=Array.prototype.slice;if(e.event.fixHooks)for(var f=o.length;f;)e.event.fixHooks[o[--f]]=e.event.mouseHooks;var l=e.event.special.mousewheel={version:"3.1.11",setup:function(){if(this.addEventListener)for(var n=u.length;n;)this.addEventListener(u[--n],t,!1);else this.onmousewheel=t;e.data(this,"mousewheel-line-height",l.getLineHeight(this)),e.data(this,"mousewheel-page-height",l.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var n=u.length;n;)this.removeEventListener(u[--n],t,!1);else this.onmousewheel=null;e.removeData(this,"mousewheel-line-height"),e.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var n=e(t)["offsetParent"in e.fn?"offsetParent":"parent"]();return n.length||(n=e("body")),parseInt(n.css("fontSize"),10)},getPageHeight:function(t){return e(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})});e(t).ready($);window._photobox={DOM:{overlay:X},close:ct,history:rt,defaults:W}})(jQuery,document,window)