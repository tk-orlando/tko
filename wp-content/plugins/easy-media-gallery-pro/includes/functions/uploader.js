/* @since 1.5.1.7 */
jQuery(document).ready(function(e){function t(){var t={},i=[],l=0;e(y).find("li").each(function(){var a=e(this).attr("id");null==t[a]?t[a]=!0:(i.push(e(this).length),e(this).remove()),l=r-i.length}),i.length&&e(".emg_add_images").gnotify(""+i.length+" duplicate image(s) not inserted into the list.",{style:"bootstrap",elementPosition:"right middle",className:"error"}),l&&e.gnotify(""+l+" image(s) successfully inserted into the list.",{style:"bootstrap",globalPosition:"right top",className:"success"}),f=parseInt(jQuery(".gallitem").length),a(),0==v&&f!=m&&(jQuery("#isnoimg").hide(),jQuery("#g-img-wrap").hide(),jQuery(".emglistloader").css("height","210").addClass("emglstoader"),h.hide,setTimeout(n,300))}function i(){v=!1,jQuery("#emgexpcol").attr("data-pag","off").text("Show all Images"),jQuery(j).pagination({items:f,itemsOnPage:p,cssStyle:"light-theme",onInit:function(){jQuery(j).pagination("nextPage").pagination("prevPage"),f>=0&&(jQuery(".emglistloader").css("height","auto").removeClass("emglstoader"),jQuery("#g-img-wrap").fadeIn(1e3)),a()},onPageClick:function(e){g=p*(e-1),d=g+p,1==I?(h.hide().slice(g,d).show(),I=!1):(h.hide().slice(g,d).fadeIn(700),I=!1),a()}})}function a(){0==f||p+1>f?jQuery("#pagination, #emgexpcol").hide():jQuery("#pagination, #emgexpcol").fadeIn(1e3),0==f?jQuery("#isnoimg").fadeIn(300):jQuery("#isnoimg").hide();var e=jQuery(window).scrollTop();jQuery("html,body").animate({scrollTop:e-1},10,function(){jQuery("html,body").animate({scrollTop:jQuery(window).scrollTop()+1},10)})}function n(){0!=f&&(jQuery(".emglistloader").css("height","auto").removeClass("emglstoader"),jQuery("#g-img-wrap").fadeIn(1e3)),h=jQuery(".gallitem"),jQuery(j).pagination("updateItems",f),jQuery(j).pagination("selectPage",jQuery(j).pagination("getPagesCount")),clearTimeout(t),clearTimeout(u)}function l(){h=jQuery(".gallitem"),jQuery(j).pagination("updateItems",f),Q=parseInt(jQuery(j).pagination("getCurrentPage")),w=parseInt(jQuery(j).pagination("getPagesCount")),Q>w?jQuery(j).pagination("prevPage"):jQuery(j).pagination("selectPage",Q),clearTimeout(t),clearTimeout(u)}function o(){var e={action:"emg_updt_gall_list",pstid:emguploader.ispost_id};jQuery.post(ajaxurl,e,function(e){e&&jQuery("#isnoimg").text(e)})}var s,i,t,r,u,g,d,m,p,c=jQuery(window).width(),y=e("#g-img-wrap ul"),h=jQuery(".gallitem"),f=h.length,j=jQuery("#pagination"),Q=null,w=null,I=!1,v=!1;p="1920"==c?39:"1360"==c?28:"1280"==c?35:"1024"==c?20:28,jQuery(".emglistloader").css("height","210").addClass("emglstoader"),jQuery(".emg_add_images").on("click",function(e){var i;return e.preventDefault(),m=f,s?void s.open():(s=wp.media.frames.downloadable_file=wp.media({title:"Select Images",button:{text:"Insert Images"},multiple:!0,library:{type:"image"}}),s.on("select",function(){var e=s.state().get("selection");e.map(function(e){if(e=e.toJSON(),e.id){i="undefined"==typeof e.sizes.thumbnail?"undefined"==typeof e.sizes.medium?e.sizes.full.url:e.sizes.medium.url:e.sizes.thumbnail.url;var t='                                <li class="gallitem" id="currentimg-'+e.id+'">								<input type="hidden" name="easmedia_meta[easmedia_metabox_media_gallery][]" value="'+e.id+'" />                                <img class="isshort" width="90" height="90" src="'+i+'" />								<span id="currentspn-'+e.id+'" title="remove image"></span>                                </li>';0==v?y.append(t).find("li:last").hide():y.append(t).find("li:last").hide().fadeIn("slow")}})}),s.on("close",function(){r=s.state().get("selection"),r=r.length,setTimeout(t,100)}),void s.open())}),setTimeout(i,1e3),jQuery("#g-img-wrap").on("click","ul li span",function(){I=!0,jQuery(this).parent().css("background","red").fadeOut(600,function(){jQuery(this).remove(),f=parseInt(jQuery(".gallitem").length),0==v&&setTimeout(l,100),0==f&&o(),a()})}),jQuery("#emgexpcol").on("click",function(){"off"==jQuery(this).attr("data-pag")?(v=!0,jQuery(j).pagination("destroy"),jQuery(".gallitem").fadeIn(2e3),jQuery(this).attr("data-pag","on").text("Hide")):(v=!1,jQuery(".emglistloader").css("height","300").addClass("emglstoader"),jQuery(".gallitem").fadeOut(300),f=jQuery(".gallitem").length,h=jQuery(".gallitem"),jQuery(j).pagination("redraw"),setTimeout(i,2500),jQuery(this).attr("data-pag","off").text("Show all Images"),jQuery("html,body").animate({scrollTop:parseInt(jQuery("#g-img-wrap").offset().top-200)},1500))}),jQuery(".isshort").lazyload({effect:"fadeIn",failure_limit:10,skip_invisible:!0,threshold:200,load:function(){}})});